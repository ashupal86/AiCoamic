{% extends "base.html" %}

{% block title %}{{ story.title }} | AI Comic Generator{% endblock %}

{% block styles %}
<style>
    :root {
        --primary: #6c5ce7;
        --secondary: #a29bfe;
        --accent: #fd79a8;
        --light: #f8f9fa;
        --dark: #343a40;
    }
    
    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--dark);
        color: var(--light);
    }
    
    .story-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: #2d3436;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    .story-title {
        font-family: 'Bangers', cursive;
        font-size: 3rem;
        margin-bottom: 1.5rem;
        text-align: center;
        color: var(--accent);
        text-shadow: 3px 3px 0px rgba(0,0,0,0.2);
        letter-spacing: 2px;
    }
    
    .story-intro {
        font-size: 1.2rem;
        line-height: 1.6;
        margin-bottom: 2rem;
        padding: 1.5rem;
        background-color: #1e272e;
        border-left: 5px solid var(--primary);
        border-radius: 5px;
    }
    
    .story-panels {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }
    
    .story-panel {
        background-color: #222831;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        border-top: 4px solid var(--primary);
    }
    
    .panel-title {
        font-family: 'Bangers', cursive;
        font-size: 1.8rem;
        margin-bottom: 1rem;
        color: var(--secondary);
        text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
    }
    
    .panel-content {
        font-size: 1.1rem;
        line-height: 1.6;
    }
    
    .dialogue {
        font-family: 'Comic Neue', cursive;
        background-color: #3d3d3d;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
        border-left: 3px solid var(--accent);
        font-weight: 500;
        color: #fff;
    }
    
    .story-conclusion {
        font-size: 1.2rem;
        line-height: 1.6;
        margin-top: 2rem;
        padding: 1.5rem;
        background-color: #1e272e;
        border-left: 5px solid var(--accent);
        border-radius: 5px;
    }
    
    .btn-back {
        margin-top: 2rem;
        background-color: var(--primary);
        color: white;
        padding: 0.7rem 1.5rem;
        border-radius: 5px;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-block;
        text-decoration: none;
    }
    
    .btn-back:hover {
        background-color: var(--secondary);
        transform: translateY(-2px);
    }
    
    .sound-effect {
        font-family: 'Bangers', cursive;
        color: var(--accent);
        font-size: 1.4rem;
        letter-spacing: 1px;
        text-align: center;
        margin: 1rem 0;
        text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
    }
    
    /* Bounce animation for sound effects */
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
        40% {transform: translateY(-10px);}
        60% {transform: translateY(-5px);}
    }
    
    .animate-bounce {
        animation: bounce 1s ease infinite;
        display: inline-block;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="story-container">
        <h1 class="story-title">{{ story.title }}</h1>
        
        {% set intro, panels = story.markdown_story|split_by_panels %}
        
        <div class="story-intro">
            {{ intro|join(' ')|safe }}
        </div>
        
        <div class="story-panels">
            {% for panel in panels %}
                {% set panel_title = panel[0]|replace('## ', '') %}
                {% set panel_content = panel|join(' ')|replace(panel[0], '')|trim %}
                
                <div class="story-panel">
                    <h2 class="panel-title">{{ panel_title }}</h2>
                    
                    {% set clean_content = panel_content|replace('**Visual Description:**', '')|replace('**Dialogue:**', '') %}
                    
                    <div class="panel-content">
                        {% if '**Dialogue:**' in panel_content %}
                            {% set parts = panel_content.split('**Dialogue:**') %}
                            
                            {% if parts|length > 1 %}
                                {% set dialogue = parts[1]|trim %}
                                <div class="dialogue">
                                    {{ dialogue|safe }}
                                </div>
                                
                                {% if 'CRASH!' in dialogue or 'BOOM!' in dialogue or 'BAM!' in dialogue or 'POW!' in dialogue or 'BANG!' in dialogue %}
                                    {% set sound_effects = ['CRASH!', 'BOOM!', 'BAM!', 'POW!', 'BANG!'] %}
                                    {% for effect in sound_effects %}
                                        {% if effect in dialogue %}
                                            <div class="sound-effect animate-bounce">{{ effect }}</div>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% endif %}
                        {% else %}
                            <div class="panel-text">
                                {{ clean_content|safe }}
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <div class="story-conclusion">
            {% if story.markdown_story.split('\n\n')|last|trim|length > 0 and not story.markdown_story.split('\n\n')|last|trim|startswith('##') %}
                <p>{{ story.markdown_story.split('\n\n')|last|trim|safe }}</p>
            {% endif %}
        </div>
        
        <div class="text-center">
            <a href="{{ url_for('index') }}" class="btn-back">‚Üê Back to Stories</a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Extract sound effects from dialogue and animate them
        const dialogues = document.querySelectorAll('.dialogue');
        const soundEffects = ['CRASH!', 'BOOM!', 'BAM!', 'POW!', 'BANG!', 'WHOOSH!', 'ZWIP!', 'WHAM!'];
        
        dialogues.forEach(dialogue => {
            let text = dialogue.innerHTML;
            soundEffects.forEach(effect => {
                if (text.includes(effect)) {
                    text = text.replace(
                        effect, 
                        `<span class="sound-effect animate-bounce">${effect}</span>`
                    );
                }
            });
            dialogue.innerHTML = text;
        });
    });
</script>
{% endblock %} 